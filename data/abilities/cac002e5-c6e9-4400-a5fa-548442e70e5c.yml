- id: cac002e5-c6e9-4400-a5fa-548442e70e5c
  description: PS script to extract memory dump/page file config (a compromised endpoint may have these settings enabled/altered).
  name: Memory Config
  tactic: response
  technique:
    attack_id: T1086
    name: PowerShell
  platforms:
    windows:
      psh:
        command: |
          $server="#{app.contact.http}";
          $url="$server/file/download";
          $wc=New-Object System.Net.WebClient;
          $wc.Headers.add("platform","windows");
          $wc.Headers.add("file","memdumpconfig.ps1")
          $data=$wc.DownloadData($url);
          $name=$wc.ResponseHeaders["Content-Disposition"].Substring($wc.ResponseHeaders["Content-Disposition"].IndexOf("filename=")+9).Replace("`"","");
          get-process | ? {$_.modules.filename -like "C:\Users\Public\$name.exe"}
          | stop-process -f;
          rm -force "C:\Users\Public\$name.exe" -ea ignore;
          [io.file]::WriteAllBytes("C:\Users\Public\$name.exe",$data) | Out-Null;
          Start-Process -FilePath C:\Users\Public\$name.exe -ArgumentList "-server
          $server -group blue" -WindowStyle hidden;'
        payloads:
        - memdumpconfig.ps1
